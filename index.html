<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gut Check - FODMAP Food Guide</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f5f5f7;
      color: #1d1d1f;
      line-height: 1.5;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    header p {
      opacity: 0.9;
      font-size: 1.1rem;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 2rem;
      padding: 1rem;
      background: white;
      border-bottom: 1px solid #e5e5e5;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      cursor: pointer;
      padding: 0.5rem 1rem;
      border-radius: 25px;
      transition: all 0.2s;
      border: 2px solid transparent;
      user-select: none;
    }

    .legend-item:hover {
      background: #f0f0f0;
    }

    .legend-item.active {
      background: #e8e8e8;
    }

    .legend-item.active[data-filter="low"] {
      border-color: #34c759;
      background: #d4edda;
    }

    .legend-item.active[data-filter="moderate"] {
      border-color: #ff9500;
      background: #fff3cd;
    }

    .legend-item.active[data-filter="high"] {
      border-color: #ff3b30;
      background: #f8d7da;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .legend-dot.low { background: #34c759; }
    .legend-dot.moderate { background: #ff9500; }
    .legend-dot.high { background: #ff3b30; }

    .food-card-container.hidden {
      display: none;
    }

    .category.hidden {
      display: none;
    }

    .filter-hint {
      text-align: center;
      padding: 0.5rem;
      font-size: 0.8rem;
      color: #86868b;
      background: #f5f5f7;
    }

    .controls {
      background: white;
      padding: 1rem 2rem;
      border-bottom: 1px solid #e5e5e5;
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .search-container {
      position: relative;
      flex: 1;
      max-width: 400px;
      min-width: 200px;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.75rem;
      border: 2px solid #e5e5e5;
      border-radius: 25px;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-input:focus {
      border-color: #667eea;
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #86868b;
      font-size: 1rem;
    }

    .search-clear {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #86868b;
      font-size: 1.2rem;
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: none;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .search-clear:hover {
      background: #e5e5e5;
      color: #1d1d1f;
    }

    .search-clear.visible {
      display: flex;
    }

    .view-toggle {
      display: flex;
      gap: 0.5rem;
    }

    .view-btn {
      padding: 0.6rem 1.2rem;
      border: 2px solid #e5e5e5;
      background: white;
      border-radius: 25px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }

    .view-btn:hover {
      background: #f0f0f0;
    }

    .view-btn.active {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    .no-results {
      text-align: center;
      padding: 3rem;
      color: #86868b;
      font-size: 1.1rem;
    }

    .food-category-tag {
      font-size: 0.7rem;
      color: #86868b;
      margin-top: 0.25rem;
    }

    main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .category {
      margin-bottom: 3rem;
    }

    .category-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid #e5e5e5;
    }

    .category-icon {
      font-size: 1.75rem;
    }

    .category-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #1d1d1f;
    }

    .food-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
    }

    .food-card-container {
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: box-shadow 0.2s;
    }

    .food-card-container:hover {
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    .food-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
    }

    .food-image {
      width: 100%;
      height: 120px;
      object-fit: cover;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
    }

    .food-info {
      padding: 1rem;
    }

    .food-name {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #1d1d1f;
    }

    .fodmap-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .fodmap-badge.low {
      background: #d4edda;
      color: #155724;
    }

    .fodmap-badge.moderate {
      background: #fff3cd;
      color: #856404;
    }

    .fodmap-badge.high {
      background: #f8d7da;
      color: #721c24;
    }

    .fodmap-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .fodmap-badge.low::before { background: #34c759; }
    .fodmap-badge.moderate::before { background: #ff9500; }
    .fodmap-badge.high::before { background: #ff3b30; }

    .serving-info {
      margin-top: 0.5rem;
      font-size: 0.75rem;
      color: #86868b;
    }

    /* Flip Card Styles */
    .food-card-container {
      perspective: 1000px;
    }

    .food-card {
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .food-card-container.flipped .food-card {
      transform: rotateY(180deg);
    }

    .card-front,
    .card-back {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }

    .card-front {
      position: relative;
    }

    .card-back {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transform: rotateY(180deg);
      background: white;
      border-radius: 16px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .back-header {
      padding: 0.75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e5e5e5;
      background: #f5f5f7;
    }

    .back-header .food-name {
      margin: 0;
      font-size: 0.9rem;
    }

    .back-content {
      padding: 0.75rem 1rem;
      flex: 1;
      overflow-y: auto;
      font-size: 0.8rem;
    }

    .back-section {
      margin-bottom: 0.75rem;
    }

    .back-section:last-child {
      margin-bottom: 0;
    }

    .back-section-title {
      font-weight: 600;
      color: #86868b;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.35rem;
    }

    .fodmap-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .fodmap-pill {
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 500;
    }

    .fodmap-pill.fructans { background: #fce4ec; color: #c2185b; }
    .fodmap-pill.lactose { background: #e3f2fd; color: #1565c0; }
    .fodmap-pill.fructose { background: #fff3e0; color: #ef6c00; }
    .fodmap-pill.gos { background: #e8f5e9; color: #2e7d32; }
    .fodmap-pill.sorbitol { background: #f3e5f5; color: #7b1fa2; }
    .fodmap-pill.mannitol { background: #e0f7fa; color: #00838f; }

    .reasons-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .reasons-list li {
      position: relative;
      padding-left: 0.9rem;
      margin-bottom: 0.2rem;
      color: #1d1d1f;
    }

    .reasons-list li::before {
      content: '‚Ä¢';
      position: absolute;
      left: 0;
      color: #ff3b30;
    }

    .alternatives-text {
      color: #34c759;
      font-weight: 500;
    }

    .flip-indicator {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.85rem;
      opacity: 0.4;
      transition: opacity 0.2s;
      cursor: pointer;
    }

    .food-card-container:hover .flip-indicator {
      opacity: 0.8;
    }

    .food-card-container.has-details {
      cursor: pointer;
    }

    footer {
      text-align: center;
      padding: 2rem;
      color: #86868b;
      font-size: 0.85rem;
    }

    footer a {
      color: #667eea;
    }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.75rem;
      }

      .food-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }

      .legend {
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Gut Check</h1>
    <p>Know what's safe to eat at a glance</p>
  </header>

  <div class="legend">
    <div class="legend-item" data-filter="low" onclick="toggleFilter('low')">
      <div class="legend-dot low"></div>
      <span>Low FODMAP - Safe</span>
    </div>
    <div class="legend-item" data-filter="moderate" onclick="toggleFilter('moderate')">
      <div class="legend-dot moderate"></div>
      <span>Moderate - Limit Portions</span>
    </div>
    <div class="legend-item" data-filter="high" onclick="toggleFilter('high')">
      <div class="legend-dot high"></div>
      <span>High FODMAP - Avoid</span>
    </div>
  </div>
  <div class="filter-hint" id="filterHint">Click a category above to filter foods</div>

  <div class="controls">
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" id="searchInput" placeholder="Search foods..." oninput="handleSearch(this.value)">
      <span class="search-clear" id="searchClear" onclick="clearSearch()">‚úï</span>
    </div>
    <div class="view-toggle">
      <button class="view-btn active" data-view="category" onclick="setView('category')">By Category</button>
      <button class="view-btn" data-view="alphabetical" onclick="setView('alphabetical')">A-Z</button>
    </div>
  </div>

  <main id="app"></main>

  <footer>
    <p>Data based on <a href="https://www.monashfodmap.com" target="_blank">Monash University FODMAP Research</a></p>
    <p style="margin-top: 0.5rem;">Always consult a dietitian before starting a FODMAP diet.</p>
  </footer>

  <script>
    // Detailed FODMAP info for high FODMAP foods (for flip cards)
    // This data structure is separate for future API migration
    const foodDetails = {
      // Vegetables
      "Garlic": {
        fodmapTypes: ["fructans"],
        reasons: ["Very high in fructans", "Even small amounts trigger symptoms"],
        alternatives: ["Garlic-infused oil", "Chives", "Asafoetida"]
      },
      "Onion": {
        fodmapTypes: ["fructans"],
        reasons: ["High fructan content", "Found in many sauces/dishes"],
        alternatives: ["Green part of spring onion", "Chives", "Garlic-infused oil"]
      },
      "Mushrooms": {
        fodmapTypes: ["mannitol"],
        reasons: ["High in mannitol (polyol)", "All varieties are high FODMAP"],
        alternatives: ["Oyster mushrooms (small serve)", "Canned champignon"]
      },
      "Cauliflower": {
        fodmapTypes: ["mannitol"],
        reasons: ["Contains mannitol", "Large serves problematic"],
        alternatives: ["Broccoli heads", "Bok choy"]
      },
      "Asparagus": {
        fodmapTypes: ["fructans"],
        reasons: ["Contains fructans", "Moderate portions only"],
        alternatives: ["Green beans", "Bell peppers"]
      },

      // Fruits
      "Apple": {
        fodmapTypes: ["fructose", "sorbitol"],
        reasons: ["High fructose (excess)", "Contains sorbitol"],
        alternatives: ["Unripe banana", "Oranges", "Strawberries"]
      },
      "Pear": {
        fodmapTypes: ["fructose", "sorbitol"],
        reasons: ["Very high in fructose", "Contains sorbitol"],
        alternatives: ["Kiwi", "Grapes", "Cantaloupe"]
      },
      "Mango": {
        fodmapTypes: ["fructose"],
        reasons: ["High fructose content", "Even small amounts high"],
        alternatives: ["Papaya", "Pineapple", "Passion fruit"]
      },
      "Watermelon": {
        fodmapTypes: ["fructose", "mannitol"],
        reasons: ["High fructose", "Contains mannitol"],
        alternatives: ["Cantaloupe", "Honeydew (small)"]
      },
      "Cherries": {
        fodmapTypes: ["fructose", "sorbitol"],
        reasons: ["High sorbitol content", "Excess fructose"],
        alternatives: ["Blueberries", "Strawberries"]
      },
      "Peach": {
        fodmapTypes: ["sorbitol"],
        reasons: ["High sorbitol (polyol)", "Stone fruits problematic"],
        alternatives: ["Oranges", "Pineapple"]
      },
      "Blackberries": {
        fodmapTypes: ["fructose"],
        reasons: ["High fructose content"],
        alternatives: ["Blueberries", "Raspberries (small serve)"]
      },

      // Grains
      "Brioche": {
        fodmapTypes: ["fructans", "lactose", "fructose"],
        reasons: ["Wheat flour (fructans)", "Dairy (milk, butter)", "Often contains honey"],
        alternatives: ["GF bread", "Sourdough (spelt)"]
      },
      "Barley": {
        fodmapTypes: ["fructans"],
        reasons: ["High fructan grain", "Found in many beers"],
        alternatives: ["Rice", "Quinoa", "Oats"]
      },
      "Rye": {
        fodmapTypes: ["fructans"],
        reasons: ["High fructan content", "Includes rye bread"],
        alternatives: ["Spelt sourdough", "GF bread"]
      },
      "Couscous": {
        fodmapTypes: ["fructans"],
        reasons: ["Made from wheat", "High in fructans"],
        alternatives: ["Quinoa", "Rice", "Buckwheat"]
      },

      // Dairy
      "Milk (Regular)": {
        fodmapTypes: ["lactose"],
        reasons: ["High lactose content", "Most common trigger"],
        alternatives: ["Lactose-free milk", "Almond milk", "Oat milk"]
      },
      "Ice Cream": {
        fodmapTypes: ["lactose"],
        reasons: ["High lactose from milk/cream", "Often contains fructose"],
        alternatives: ["Lactose-free ice cream", "Sorbet (check ingredients)"]
      },
      "Yogurt (Regular)": {
        fodmapTypes: ["lactose"],
        reasons: ["Contains lactose", "Amount varies by brand"],
        alternatives: ["Lactose-free yogurt", "Coconut yogurt"]
      },
      "Cream": {
        fodmapTypes: ["lactose"],
        reasons: ["Contains lactose", "Heavy cream lower"],
        alternatives: ["Coconut cream", "Lactose-free cream"]
      },

      // Nuts
      "Cashews": {
        fodmapTypes: ["gos"],
        reasons: ["High in GOS", "Even small amounts high"],
        alternatives: ["Macadamias", "Peanuts", "Walnuts"]
      },
      "Pistachios": {
        fodmapTypes: ["fructans", "gos"],
        reasons: ["Contains fructans", "Also high in GOS"],
        alternatives: ["Pine nuts", "Macadamias", "Peanuts"]
      },

      // Legumes
      "Baked Beans": {
        fodmapTypes: ["gos", "fructans"],
        reasons: ["Navy beans high in GOS", "Often onion/garlic added"],
        alternatives: ["Canned lentils (small)", "Firm tofu"]
      },
      "Kidney Beans": {
        fodmapTypes: ["gos"],
        reasons: ["Very high GOS content", "All red beans similar"],
        alternatives: ["Canned chickpeas (¬º cup)", "Firm tofu"]
      },
      "Hummus": {
        fodmapTypes: ["gos", "fructans"],
        reasons: ["Chickpea-based (GOS)", "Contains garlic"],
        alternatives: ["Baba ganoush (no garlic)", "Tahini"]
      },
      "Soybeans": {
        fodmapTypes: ["gos", "fructans"],
        reasons: ["High GOS content", "Includes edamame"],
        alternatives: ["Firm tofu", "Tempeh"]
      },

      // Condiments
      "Honey": {
        fodmapTypes: ["fructose"],
        reasons: ["Very high fructose", "Excess fructose load"],
        alternatives: ["Maple syrup", "Rice malt syrup"]
      },
      "Agave": {
        fodmapTypes: ["fructose"],
        reasons: ["Extremely high fructose", "Worse than honey"],
        alternatives: ["Maple syrup", "Stevia", "Sugar"]
      },

      // Beverages
      "Apple Juice": {
        fodmapTypes: ["fructose", "sorbitol"],
        reasons: ["Concentrated fructose", "From apples (sorbitol)"],
        alternatives: ["Orange juice (small)", "Cranberry juice"]
      },
      "Chamomile Tea": {
        fodmapTypes: ["fructans"],
        reasons: ["Chamomile flowers high in fructans", "Strong brews worse"],
        alternatives: ["Peppermint tea", "Green tea", "Ginger tea"]
      },
      "Kombucha": {
        fodmapTypes: ["fructose", "fructans"],
        reasons: ["Fermented with sugar", "May contain high FODMAP ingredients"],
        alternatives: ["Water kefir", "Plain water", "Green tea"]
      }
    };

    // Food data with emojis as images
    const foodData = {
      vegetables: {
        icon: "ü•¨",
        title: "Vegetables",
        foods: [
          { name: "Asparagus", emoji: "üåø", level: "high" },
          { name: "Bell Pepper", emoji: "ü´ë", level: "low" },
          { name: "Bok Choy", emoji: "ü•¨", level: "low" },
          { name: "Broccoli", emoji: "ü•¶", level: "low", serving: "¬æ cup heads" },
          { name: "Cabbage", emoji: "ü•¨", level: "low", serving: "¬æ cup" },
          { name: "Carrot", emoji: "ü•ï", level: "low" },
          { name: "Cauliflower", emoji: "ü•¨", level: "high" },
          { name: "Celery", emoji: "ü•¨", level: "moderate", serving: "<5cm stalk" },
          { name: "Cucumber", emoji: "ü•í", level: "low" },
          { name: "Eggplant", emoji: "üçÜ", level: "low", serving: "1 cup" },
          { name: "Garlic", emoji: "üßÑ", level: "high" },
          { name: "Green Beans", emoji: "ü´õ", level: "low" },
          { name: "Kale", emoji: "ü•¨", level: "low" },
          { name: "Lettuce", emoji: "ü•¨", level: "low" },
          { name: "Mushrooms", emoji: "üçÑ", level: "high" },
          { name: "Onion", emoji: "üßÖ", level: "high" },
          { name: "Potato", emoji: "ü•î", level: "low" },
          { name: "Pumpkin", emoji: "üéÉ", level: "low", serving: "63g" },
          { name: "Spinach", emoji: "ü•¨", level: "low" },
          { name: "Sweet Potato", emoji: "üç†", level: "low", serving: "¬Ω cup" },
          { name: "Tomato", emoji: "üçÖ", level: "low" },
          { name: "Zucchini", emoji: "ü•í", level: "low", serving: "65g" },
        ]
      },
      fruits: {
        icon: "üçé",
        title: "Fruits",
        foods: [
          { name: "Apple", emoji: "üçé", level: "high" },
          { name: "Avocado", emoji: "ü•ë", level: "moderate", serving: "‚Öõ avocado" },
          { name: "Banana (Unripe)", emoji: "üçå", level: "low", serving: "1 medium" },
          { name: "Banana (Ripe)", emoji: "üçå", level: "moderate" },
          { name: "Blackberries", emoji: "ü´ê", level: "high" },
          { name: "Blueberries", emoji: "ü´ê", level: "low", serving: "1 cup" },
          { name: "Cantaloupe", emoji: "üçà", level: "low", serving: "¬æ cup" },
          { name: "Cherries", emoji: "üçí", level: "high" },
          { name: "Grapes", emoji: "üçá", level: "low", serving: "10 grapes" },
          { name: "Kiwi", emoji: "ü•ù", level: "low", serving: "2 small" },
          { name: "Lemon", emoji: "üçã", level: "low" },
          { name: "Mango", emoji: "ü•≠", level: "high" },
          { name: "Orange", emoji: "üçä", level: "low" },
          { name: "Papaya", emoji: "üçà", level: "low" },
          { name: "Peach", emoji: "üçë", level: "high" },
          { name: "Pear", emoji: "üçê", level: "high" },
          { name: "Pineapple", emoji: "üçç", level: "low", serving: "1 cup" },
          { name: "Raspberry", emoji: "üçì", level: "low", serving: "‚Öì cup" },
          { name: "Strawberry", emoji: "üçì", level: "low", serving: "5 medium" },
          { name: "Watermelon", emoji: "üçâ", level: "high" },
        ]
      },
      grains: {
        icon: "üåæ",
        title: "Grains & Cereals",
        foods: [
          { name: "Barley", emoji: "üåæ", level: "high" },
          { name: "Brioche", emoji: "üçû", level: "high" },
          { name: "Buckwheat", emoji: "üåæ", level: "low" },
          { name: "Corn Tortillas", emoji: "ü´ì", level: "low", serving: "3 pieces" },
          { name: "Couscous", emoji: "üçö", level: "high" },
          { name: "GF Bread", emoji: "üçû", level: "low" },
          { name: "GF Pasta", emoji: "üçù", level: "low" },
          { name: "Oats", emoji: "ü•£", level: "low", serving: "¬Ω cup" },
          { name: "Popcorn", emoji: "üçø", level: "low" },
          { name: "Quinoa", emoji: "üçö", level: "low" },
          { name: "Rice", emoji: "üçö", level: "low" },
          { name: "Rice Noodles", emoji: "üçú", level: "low" },
          { name: "Rye", emoji: "üçû", level: "high" },
          { name: "Sourdough (Spelt)", emoji: "üçû", level: "low" },
          { name: "Challah Bread", emoji: "üçû", level: "moderate", serving: "1 slice" },
          { name: "Wheat Bread", emoji: "üçû", level: "moderate", serving: "1 slice" },
          { name: "Wheat Pasta", emoji: "üçù", level: "moderate", serving: "¬Ω cup" },
        ]
      },
      dairy: {
        icon: "ü•õ",
        title: "Dairy & Alternatives",
        foods: [
          { name: "Almond Milk", emoji: "ü•õ", level: "low" },
          { name: "Brie", emoji: "üßÄ", level: "low" },
          { name: "Butter", emoji: "üßà", level: "low" },
          { name: "Cheddar", emoji: "üßÄ", level: "low" },
          { name: "Coconut Milk", emoji: "ü••", level: "low", serving: "125ml" },
          { name: "Cottage Cheese", emoji: "üßÄ", level: "moderate", serving: "2 tbsp" },
          { name: "Cream", emoji: "ü•õ", level: "high" },
          { name: "Eggs", emoji: "ü•ö", level: "low" },
          { name: "Feta", emoji: "üßÄ", level: "low" },
          { name: "Ice Cream", emoji: "üç¶", level: "high" },
          { name: "Lactose-Free Milk", emoji: "ü•õ", level: "low" },
          { name: "Milk (Regular)", emoji: "ü•õ", level: "high" },
          { name: "Mozzarella", emoji: "üßÄ", level: "low" },
          { name: "Parmesan", emoji: "üßÄ", level: "low" },
          { name: "Yogurt (Regular)", emoji: "ü•õ", level: "high" },
          { name: "Yogurt (Lactose-Free)", emoji: "ü•õ", level: "low" },
        ]
      },
      proteins: {
        icon: "üçó",
        title: "Proteins",
        foods: [
          { name: "Beef", emoji: "ü•©", level: "low" },
          { name: "Chicken", emoji: "üçó", level: "low" },
          { name: "Crab", emoji: "ü¶Ä", level: "low" },
          { name: "Fish", emoji: "üêü", level: "low" },
          { name: "Lamb", emoji: "üçñ", level: "low" },
          { name: "Lobster", emoji: "ü¶û", level: "low" },
          { name: "Pork", emoji: "ü•ì", level: "low" },
          { name: "Prawns", emoji: "ü¶ê", level: "low" },
          { name: "Salmon", emoji: "üç£", level: "low" },
          { name: "Sausages", emoji: "üå≠", level: "moderate" },
          { name: "Tempeh", emoji: "ü´ò", level: "low" },
          { name: "Tofu (Firm)", emoji: "üßä", level: "low" },
          { name: "Tuna", emoji: "üêü", level: "low" },
          { name: "Turkey", emoji: "ü¶É", level: "low" },
        ]
      },
      nuts_seeds: {
        icon: "ü•ú",
        title: "Nuts & Seeds",
        foods: [
          { name: "Almonds", emoji: "üå∞", level: "low", serving: "10 nuts" },
          { name: "Brazil Nuts", emoji: "üå∞", level: "low", serving: "10 nuts" },
          { name: "Cashews", emoji: "üå∞", level: "high" },
          { name: "Chia Seeds", emoji: "ü´ò", level: "low" },
          { name: "Flax Seeds", emoji: "ü´ò", level: "low", serving: "1 tbsp" },
          { name: "Hazelnuts", emoji: "üå∞", level: "low", serving: "24 nuts" },
          { name: "Macadamia", emoji: "üå∞", level: "low", serving: "15 nuts" },
          { name: "Peanuts", emoji: "ü•ú", level: "low" },
          { name: "Pecans", emoji: "üå∞", level: "low", serving: "15 halves" },
          { name: "Pine Nuts", emoji: "üå∞", level: "low" },
          { name: "Pistachios", emoji: "üå∞", level: "high" },
          { name: "Pumpkin Seeds", emoji: "üéÉ", level: "low" },
          { name: "Sunflower Seeds", emoji: "üåª", level: "low" },
          { name: "Walnuts", emoji: "üå∞", level: "low", serving: "15 halves" },
        ]
      },
      legumes: {
        icon: "ü´ò",
        title: "Legumes",
        foods: [
          { name: "Baked Beans", emoji: "ü´ò", level: "high" },
          { name: "Black Beans", emoji: "ü´ò", level: "moderate", serving: "¬º cup" },
          { name: "Broad Beans", emoji: "ü´ò", level: "high" },
          { name: "Chickpeas (Canned)", emoji: "ü´ò", level: "low", serving: "¬º cup" },
          { name: "Hummus", emoji: "ü´ò", level: "high" },
          { name: "Kidney Beans", emoji: "ü´ò", level: "high" },
          { name: "Lentils (Canned)", emoji: "ü´ò", level: "low", serving: "¬º cup" },
          { name: "Soybeans", emoji: "ü´ò", level: "high" },
          { name: "Split Peas", emoji: "ü´ò", level: "high" },
        ]
      },
      condiments: {
        icon: "üßÇ",
        title: "Condiments & Sweeteners",
        foods: [
          { name: "Agave", emoji: "üçØ", level: "high" },
          { name: "Dark Chocolate", emoji: "üç´", level: "low", serving: "5 squares" },
          { name: "Garlic Oil", emoji: "ü´í", level: "low" },
          { name: "Honey", emoji: "üçØ", level: "high" },
          { name: "Ketchup", emoji: "üçÖ", level: "low", serving: "1 sachet" },
          { name: "Maple Syrup", emoji: "üçÅ", level: "low" },
          { name: "Mayonnaise", emoji: "ü•´", level: "low" },
          { name: "Miso Paste", emoji: "ü•£", level: "low" },
          { name: "Mustard", emoji: "üü°", level: "low" },
          { name: "Olive Oil", emoji: "ü´í", level: "low" },
          { name: "Peanut Butter", emoji: "ü•ú", level: "low" },
          { name: "Soy Sauce", emoji: "ü•¢", level: "low" },
          { name: "Stevia", emoji: "üåø", level: "low" },
          { name: "Sugar", emoji: "üßÇ", level: "low" },
          { name: "Tahini", emoji: "ü•£", level: "low", serving: "30g" },
          { name: "Vinegar", emoji: "üç∂", level: "low" },
        ]
      },
      beverages: {
        icon: "ü•§",
        title: "Beverages",
        foods: [
          { name: "Apple Juice", emoji: "üßÉ", level: "high" },
          { name: "Beer", emoji: "üç∫", level: "moderate", serving: "1 bottle" },
          { name: "Chamomile Tea", emoji: "üçµ", level: "high" },
          { name: "Coffee", emoji: "‚òï", level: "low" },
          { name: "Cranberry Juice", emoji: "üßÉ", level: "low", serving: "¬æ cup" },
          { name: "Green Tea", emoji: "üçµ", level: "low" },
          { name: "Kombucha", emoji: "üçµ", level: "high" },
          { name: "Orange Juice", emoji: "üçä", level: "low", serving: "100ml" },
          { name: "Peppermint Tea", emoji: "üçµ", level: "low" },
          { name: "Water", emoji: "üíß", level: "low" },
          { name: "Wine", emoji: "üç∑", level: "moderate", serving: "1 glass" },
        ]
      }
    };

    // Current view mode: 'category' or 'alphabetical'
    let currentView = 'category';

    // Current search query
    let searchQuery = '';

    // Current active filter (null = show all)
    let activeFilter = null;

    // Get all foods as a flat array with category info
    function getAllFoods() {
      const allFoods = [];
      for (const [categoryKey, category] of Object.entries(foodData)) {
        for (const food of category.foods) {
          allFoods.push({
            ...food,
            categoryKey,
            categoryTitle: category.title,
            categoryIcon: category.icon
          });
        }
      }
      return allFoods.sort((a, b) => a.name.localeCompare(b.name));
    }

    // Get food details for flip card (returns null if no details available)
    function getFoodDetails(foodName) {
      return foodDetails[foodName] || null;
    }

    // Render the back of card content
    function renderCardBack(food, details) {
      if (!details) return '';

      const pillsHtml = details.fodmapTypes
        .map(type => `<span class="fodmap-pill ${type}">${type}</span>`)
        .join('');

      const reasonsHtml = details.reasons
        .map(reason => `<li>${reason}</li>`)
        .join('');

      const alternativesHtml = details.alternatives
        ? `<div class="back-section">
            <div class="back-section-title">Try Instead</div>
            <div class="alternatives-text">${details.alternatives.join(', ')}</div>
          </div>`
        : '';

      return `
        <div class="card-back">
          <div class="back-header">
            <div class="food-name">${food.name}</div>
            <span class="fodmap-badge ${food.level}">${food.level}</span>
          </div>
          <div class="back-content">
            <div class="back-section">
              <div class="back-section-title">Contains</div>
              <div class="fodmap-pills">${pillsHtml}</div>
            </div>
            <div class="back-section">
              <div class="back-section-title">Why</div>
              <ul class="reasons-list">${reasonsHtml}</ul>
            </div>
            ${alternativesHtml}
          </div>
        </div>
      `;
    }

    // Render food card HTML
    function renderFoodCard(food, showCategory = false) {
      const details = getFoodDetails(food.name);
      const hasDetails = details !== null;
      const flipIndicator = hasDetails ? '<span class="flip-indicator">‚ìò</span>' : '';
      const backHtml = hasDetails ? renderCardBack(food, details) : '';

      return `
        <div class="food-card-container ${hasDetails ? 'has-details' : ''}" data-level="${food.level}" data-name="${food.name.toLowerCase()}">
          <div class="food-card">
            <div class="card-front">
              <div class="food-image">${food.emoji}</div>
              <div class="food-info">
                <div class="food-name">${food.name}</div>
                <span class="fodmap-badge ${food.level}">${food.level}</span>
                ${food.serving ? `<div class="serving-info">Safe: ${food.serving}</div>` : ''}
                ${showCategory ? `<div class="food-category-tag">${food.categoryIcon} ${food.categoryTitle}</div>` : ''}
              </div>
              ${flipIndicator}
            </div>
            ${backHtml}
          </div>
        </div>
      `;
    }

    // Render by category view
    function renderCategoryView() {
      const app = document.getElementById('app');
      app.innerHTML = '';

      for (const [categoryKey, category] of Object.entries(foodData)) {
        const sortedFoods = [...category.foods].sort((a, b) =>
          a.name.localeCompare(b.name)
        );

        const categoryHtml = `
          <section class="category" data-category="${categoryKey}">
            <div class="category-header">
              <span class="category-icon">${category.icon}</span>
              <h2 class="category-title">${category.title}</h2>
            </div>
            <div class="food-grid">
              ${sortedFoods.map(food => renderFoodCard(food, false)).join('')}
            </div>
          </section>
        `;

        app.innerHTML += categoryHtml;
      }
    }

    // Render alphabetical view
    function renderAlphabeticalView() {
      const app = document.getElementById('app');
      app.innerHTML = '';

      const allFoods = getAllFoods();

      const html = `
        <section class="category">
          <div class="category-header">
            <span class="category-icon">üî§</span>
            <h2 class="category-title">All Foods (A-Z)</h2>
          </div>
          <div class="food-grid">
            ${allFoods.map(food => renderFoodCard(food, true)).join('')}
          </div>
        </section>
      `;

      app.innerHTML = html;
    }

    // Render the app based on current view
    function renderApp() {
      if (currentView === 'category') {
        renderCategoryView();
      } else {
        renderAlphabeticalView();
      }
      applyFilters();
    }

    // Set view mode
    function setView(view) {
      currentView = view;

      // Update button states
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === view);
      });

      renderApp();
    }

    // Handle search input
    function handleSearch(query) {
      searchQuery = query.toLowerCase().trim();

      // Show/hide clear button
      const clearBtn = document.getElementById('searchClear');
      clearBtn.classList.toggle('visible', query.length > 0);

      applyFilters();
    }

    // Clear search
    function clearSearch() {
      const searchInput = document.getElementById('searchInput');
      searchInput.value = '';
      searchQuery = '';
      document.getElementById('searchClear').classList.remove('visible');
      applyFilters();
      searchInput.focus();
    }

    // Toggle filter when clicking legend items
    function toggleFilter(level) {
      const legendItems = document.querySelectorAll('.legend-item');
      const filterHint = document.getElementById('filterHint');

      // If clicking the same filter, clear it
      if (activeFilter === level) {
        activeFilter = null;
        legendItems.forEach(item => item.classList.remove('active'));
        filterHint.textContent = 'Click a category above to filter foods';
      } else {
        activeFilter = level;
        legendItems.forEach(item => {
          if (item.dataset.filter === level) {
            item.classList.add('active');
          } else {
            item.classList.remove('active');
          }
        });

        const labels = {
          low: 'Showing: Low FODMAP foods (safe to eat)',
          moderate: 'Showing: Moderate FODMAP foods (limit portions)',
          high: 'Showing: High FODMAP foods (avoid or limit)'
        };
        filterHint.textContent = labels[level] + ' - Click again to show all';
      }

      applyFilters();
    }

    // Apply all filters (FODMAP level + search)
    function applyFilters() {
      const foodCards = document.querySelectorAll('.food-card-container');
      const categories = document.querySelectorAll('.category');
      let visibleCount = 0;

      foodCards.forEach(card => {
        const matchesLevel = activeFilter === null || card.dataset.level === activeFilter;
        const matchesSearch = searchQuery === '' || card.dataset.name.includes(searchQuery);

        if (matchesLevel && matchesSearch) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // Hide categories that have no visible foods
      categories.forEach(category => {
        const visibleCards = category.querySelectorAll('.food-card-container:not(.hidden)');
        if (visibleCards.length === 0) {
          category.classList.add('hidden');
        } else {
          category.classList.remove('hidden');
        }
      });

      // Show "no results" message if nothing matches
      let noResults = document.querySelector('.no-results');
      if (visibleCount === 0) {
        if (!noResults) {
          noResults = document.createElement('div');
          noResults.className = 'no-results';
          document.getElementById('app').appendChild(noResults);
        }
        noResults.textContent = `No foods found matching "${searchQuery}"`;
        noResults.style.display = 'block';
      } else if (noResults) {
        noResults.style.display = 'none';
      }
    }

    // Handle card flip on click
    function handleCardClick(event) {
      const container = event.target.closest('.food-card-container.has-details');
      if (container) {
        container.classList.toggle('flipped');
      }
    }

    // Initialize
    renderApp();

    // Add click listener for card flips (event delegation)
    document.getElementById('app').addEventListener('click', handleCardClick);
  </script>
</body>
</html>
